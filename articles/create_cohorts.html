<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use DrugUtilisation to create a cohort • DrugUtilisation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use DrugUtilisation to create a cohort">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DrugUtilisation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package functionalities</h6></li>
    <li><a class="dropdown-item" href="../articles/mock_data.html">Create mock data to test DrugUtilisation package</a></li>
    <li><a class="dropdown-item" href="../articles/create_cohorts.html">Use DrugUtilisation to create a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/indication.html">Add indications to Drug Utilisation Cohort</a></li>
    <li><a class="dropdown-item" href="../articles/daily_dose_calculation.html">Characterise a cohort using Drug Utilisation</a></li>
    <li><a class="dropdown-item" href="../articles/drug_utilisation.html">Getting drug utilisation related information of subjects in a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/summarise_treatments.html">Add treatment summary to a Drug Utilisation cohort</a></li>
    <li><a class="dropdown-item" href="../articles/treatment_discontinuation.html">Assessing time to treatment discontinuation</a></li>
    <li><a class="dropdown-item" href="../articles/drug_restart.html">Assessing drug restart and switching after treatment</a></li>
    <li><a class="dropdown-item" href="../articles/TBR_add_drug_use.html">Add drug related information to a Drug Utilisation cohort</a></li>
    <li><a class="dropdown-item" href="../articles/TBR_route_pattern_dose.html">Guide on using DrugUtilisataion package to compute drug use related information</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use DrugUtilisation to create a cohort</h1>
                        <h4 data-toc-skip class="author">Martí Català,
Edward Burn</h4>
            
            <h4 data-toc-skip class="date">2024-07-19</h4>
      

      <div class="d-none name"><code>create_cohorts.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we will introduce how to create a drug users
cohorts. A cohort is a set of people that satisfy a certain inclusion
criteria durng a certain time frame. The cohort object is defined in :
<code>vignette("a03_cohort_table", package = "omopgenerics")</code>.</p>
<p>The function <code>generateDrugUtilisationCohortSet</code> is used to
generate cohorts of drug users based on the drug_exposure table and a
conceptSet.</p>
<p>These cohorts can be subsetted to the exposures of interest applying
the different inclusion criteria:</p>
<ul>
<li><p>Require that entries are in a certain date range
<code><a href="../reference/requireDrugInDateRange.html">requireDrugInDateRange()</a></code>.</p></li>
<li><p>Subset to the first entry
<code><a href="../reference/requireIsFirstDrugEntry.html">requireIsFirstDrugEntry()</a></code>.</p></li>
<li><p>Require a certain time in observation before the entries
<code><a href="../reference/requireObservationBeforeDrug.html">requireObservationBeforeDrug()</a></code>.</p></li>
<li><p>Require a certain time before exposure
<code><a href="../reference/requirePriorDrugWashout.html">requirePriorDrugWashout()</a></code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="creating-a-cdm_reference-object">Creating a <code>cdm_reference</code> object<a class="anchor" aria-label="anchor" href="#creating-a-cdm_reference-object"></a>
</h2>
<p>The first thing that we need is a cdm reference object to our OMOP
CDM instance. You can learn how to create cdm references using
CDMConnector here: CDMConnector::a04_DBI_connection_examples</p>
<p>The DrugUtilisation packages contains some mock data that can be
useful to test the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/">DrugUtilisation</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockDrugUtilisation.html">mockDrugUtilisation</a></span><span class="op">(</span>numberIndividuals <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of DUS MOCK</span> <span style="color: #00BBBB;">───────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, concept, concept_ancestor,</span></span>
<span><span class="co">#&gt; drug_strength, drug_exposure, condition_occurrence, visit_occurrence,</span></span>
<span><span class="co">#&gt; observation, concept_relationship</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> cohort1, cohort2</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-drug-users-cohort">Create a drug users cohort<a class="anchor" aria-label="anchor" href="#create-a-drug-users-cohort"></a>
</h2>
<p>To create a basic drug users cohort we need two things:</p>
<ul>
<li>A conceptSet: will determine which concepts we will use.</li>
<li>A gapEra: will determine how we will collapse those exposures.</li>
</ul>
<div class="section level3">
<h3 id="creating-a-conceptset">Creating a conceptSet<a class="anchor" aria-label="anchor" href="#creating-a-conceptset"></a>
</h3>
<p>There are four possible outputs for a conceptSet:</p>
<ul>
<li>A named list of concept ids</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>acetaminophen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conceptSet</span></span>
<span><span class="co">#&gt; $acetaminophen</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span></code></pre></div>
<ul>
<li>A <code>codelist</code> object, see omopgenerics
“a02_concept_set”</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>acetaminophen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">omopgenerics</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/newCodelist.html" class="external-link">newCodelist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conceptSet</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 codelist</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (3 codes)</span></span>
<span><span class="va">conceptSet</span><span class="op">$</span><span class="va">acetaminophen</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span></code></pre></div>
<ul>
<li>A <code>codelist_with_details</code> object, see omopgenerics
“a02_concept_set”</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>acetaminophen <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  concept_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1125315</span>, <span class="fl">1125360</span><span class="op">)</span>,</span>
<span>  concept_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"acetaminophen"</span>, <span class="st">"acetaminophen 500 MG Oral Capsule"</span><span class="op">)</span>,</span>
<span>  domain_id <span class="op">=</span> <span class="st">"Drug"</span>,</span>
<span>  vocabulary_id <span class="op">=</span> <span class="st">"RxNorm"</span>,</span>
<span>  standard_concept <span class="op">=</span> <span class="st">"S"</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">omopgenerics</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/newCodelistWithDetails.html" class="external-link">newCodelistWithDetails</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conceptSet</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 codelist with details</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (5 codes)</span></span>
<span><span class="va">conceptSet</span><span class="op">$</span><span class="va">acetaminophen</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   concept_id concept_name               domain_id vocabulary_id standard_concept</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    1<span style="text-decoration: underline;">125</span>315 acetaminophen              Drug      RxNorm        S               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    1<span style="text-decoration: underline;">125</span>360 acetaminophen 500 MG Oral… Drug      RxNorm        S</span></span></code></pre></div>
<ul>
<li>A <code>conceptSetExpression</code> object, see omopgenerics
“a02_concept_set”</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conceptSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>acetaminophen <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  concept_id <span class="op">=</span> <span class="fl">1125315</span>, </span>
<span>  excluded <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  descendants <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapped <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">omopgenerics</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/newConceptSetExpression.html" class="external-link">newConceptSetExpression</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conceptSet</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 conceptSetExpression</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (1 concept criteria)</span></span>
<span><span class="va">conceptSet</span><span class="op">$</span><span class="va">acetaminophen</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   concept_id excluded descendants mapped</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    1<span style="text-decoration: underline;">125</span>315 FALSE    TRUE        FALSE</span></span></code></pre></div>
<p>The package <a href="https://cran.r-project.org/package=CodelistGenerator" class="external-link">CodelistGenerator</a>
can be very useful to create conceptSet.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span></code></pre></div>
<p>For example we can create a conceptSet based in an ingredient with
<code><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"acetaminophen"</span><span class="op">)</span></span>
<span><span class="va">codes</span><span class="op">[[</span><span class="st">"161_acetaminophen"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1]  1125315  1125360  2905077 43135274</span></span></code></pre></div>
<p>We could also use the function <code><a href="https://darwin-eu.github.io/CodelistGenerator/reference/codesFromConceptSet.html" class="external-link">codesFromConceptSet()</a></code> to
read a concept set from a json file:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/codesFromConceptSet.html" class="external-link">codesFromConceptSet</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"acetaminophen.json"</span>, package <span class="op">=</span> <span class="st">"DrugUtilisation"</span><span class="op">)</span>, cdm <span class="op">=</span> <span class="va">cdm</span><span class="op">)</span></span>
<span><span class="va">codes</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 codelist</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (4 codes)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-gapera-parameter">The gapEra parameter<a class="anchor" aria-label="anchor" href="#the-gapera-parameter"></a>
</h3>
<p>The <code>gapEra</code> parameter is used to join exposures into
episodes, let’s say for example we have an individual with 4 drug
exposures that we are interedted in. The first two overlap each other,
then there is a gap of 29 days and two consecutive exposures:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>If we would create the episode with <strong>gapEra = 0</strong>, we
would have 3 resultant episodes, the first two that overlap would be
joined in a single episode, but then the other two would be
independent:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2020-02-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1          1 2020-03-15        2020-04-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1          1 2020-04-20        2020-05-15</span></span></code></pre>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>If, instead we would use a <strong>gapEra = 1</strong>, we would have
2 resultant episodes, the first two that overlap would be joined in a
single episode (as before), now the two consecutives exposures would be
joined in a single episode:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2020-02-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1          1 2020-03-15        2020-05-15</span></span></code></pre>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>The result would be the same for any value between 1 and 28
(<strong>gapEra ∈ [1, 28]</strong>).</p>
<p>Whereas, if we would use a <strong>gapEra = 29</strong> all the
records would be collapsed into a single episode:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2020-05-15</span></span></code></pre>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="create-your-cohort">Create your cohort<a class="anchor" aria-label="anchor" href="#create-your-cohort"></a>
</h3>
<p>We will then create now a cohort with all the drug users of
acetaminophen with a gapEra of 30 days.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"acetaminophen"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"acetaminophen"</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"acetaminophen_cohort"</span>, conceptSet <span class="op">=</span> <span class="va">codes</span>, gapEra <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of DUS MOCK</span> <span style="color: #00BBBB;">───────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, concept, concept_ancestor,</span></span>
<span><span class="co">#&gt; drug_strength, drug_exposure, condition_occurrence, visit_occurrence,</span></span>
<span><span class="co">#&gt; observation, concept_relationship</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> cohort1, cohort2, acetaminophen_cohort</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
<p>NOTE that the <code>name</code> argument is used to create the new
table in the cdm object. For database backends this is the name of the
table that will be created.</p>
<p>We can compare what we see with what we would expect if we look at
the individual with more records we can see how all of them are joined
into a single exposure as the records overlap each other:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">drug_concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">codes</span><span class="op">$</span><span class="va">acetaminophen</span> <span class="op">&amp;</span> <span class="va">person_id</span> <span class="op">==</span> <span class="fl">69</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [4 x 7]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              201        69         2<span style="text-decoration: underline;">905</span>077 2002-01-29              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>              203        69         2<span style="text-decoration: underline;">905</span>077 2001-04-23              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>              205        69         2<span style="text-decoration: underline;">905</span>077 2001-03-04              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>              204        69        43<span style="text-decoration: underline;">135</span>274 2003-10-16              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op">==</span> <span class="fl">69</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [1 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         69 2001-03-04        2004-06-02</span></span></code></pre></div>
<p>In this case gapEra did not have a big impact as we can see in the
attrition:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             71              62         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             70              62         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
<p>We can see this particular case of this individual:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">drug_concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">codes</span><span class="op">$</span><span class="va">acetaminophen</span> <span class="op">&amp;</span> <span class="va">person_id</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 7]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              143        50         1<span style="text-decoration: underline;">125</span>360 2017-04-14              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>              144        50        43<span style="text-decoration: underline;">135</span>274 2017-04-01              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;</span></span></span></code></pre></div>
<p>In this case we have 3 exposures separated by 3 days, so if we use
the 30 days gap both exposures are joined into a single episode, wheras
if we would use a gapEra smaller than 3 we would consider them as
different episodes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [1 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         50 2017-04-01        2017-04-23</span></span></code></pre></div>
<p>We can access the other cohort attributes using the adequate
functions. In settings we can see that the gapEra used is recorded or
with cohortCodelist we can see which was the codelist used to create the
cohort.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name   gap_era</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 acetaminophen 30</span></span>
<span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             70              62</span></span>
<span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCodelist.html" class="external-link">cohortCodelist</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span>, cohortId <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 codelist</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (4 codes)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="apply-inclusion-criteria-to-drug-cohorts">Apply inclusion criteria to drug cohorts<a class="anchor" aria-label="anchor" href="#apply-inclusion-criteria-to-drug-cohorts"></a>
</h2>
<p>Once we have created our base cohort using a conceptSet and a gapEra
we can apply different restrictions:</p>
<ul>
<li>require a prior un exposed time:
<code><a href="../reference/requirePriorDrugWashout.html">requirePriorDrugWashout()</a></code>
</li>
<li>require that it is the first entry:
<code><a href="../reference/requireIsFirstDrugEntry.html">requireIsFirstDrugEntry()</a></code>
</li>
<li>require a prior observation in the cdm:
<code><a href="../reference/requireObservationBeforeDrug.html">requireObservationBeforeDrug()</a></code>
</li>
<li>require that date are within a certain interval:
<code><a href="../reference/requireDrugInDateRange.html">requireDrugInDateRange()</a></code>
</li>
</ul>
<div class="section level3">
<h3 id="requirepriordrugwashout">
<code>requirePriorDrugWashout()</code><a class="anchor" aria-label="anchor" href="#requirepriordrugwashout"></a>
</h3>
<p>To require that the cohort entries (drug episodes) are incident we
would usually define a time (<code>days</code>) where the individual is
not exposed to the drug. This can be achieved using
<code><a href="../reference/requirePriorDrugWashout.html">requirePriorDrugWashout()</a></code> function. In this example we
would restrict to individuals with 365 days of no exposure:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requirePriorDrugWashout.html">requirePriorDrugWashout</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">365</span><span class="op">)</span></span></code></pre></div>
<p>The result will be a cohort with the individuals that fulfill the
criteria:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.acetaminophen_cohort&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         35 2005-11-10        2006-09-09     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         23 2003-10-29        2003-11-27     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         44 2017-01-01        2018-03-30     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         73 2011-04-02        2011-06-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1         57 2020-04-17        2020-11-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1         45 2017-07-03        2018-07-06     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         25 2020-01-04        2020-02-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         87 2020-10-02        2021-01-02     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1         77 1966-09-15        1966-12-27     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         99 2015-02-03        2020-11-01     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>This would also get recorded in the attrition, counts and
settings.</p>
<p>In the settings a new column with the specified parameter used:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name   gap_era prior_use_washout</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 acetaminophen 30      365</span></span></code></pre></div>
<p>The counts will be updated:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             66              62</span></span></code></pre></div>
<p>And the attrition will have a new line:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             71              62         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             70              62         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1             66              62         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
<p>The <code>name</code> argument can be used to put the result into a
different table in our cdm (by default the function updates the current
cohort table). Whereas the <code>cohortId</code> argument is used to
apply this criteria to only a restricted set of cohorts (by default the
same criteria is applied to all the cohort records). To show this in an
example we will create two cohorts (metformin and simvastatin) inside a
table named <code>my_cohort</code> and then apply the inclusion criteria
to only one of them (simvastatin) and save the result to a table named:
<code>my_new_cohort</code></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"metformin"</span>, <span class="st">"simvastatin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"my_cohort"</span>, conceptSet <span class="op">=</span> <span class="va">codes</span>, gapEra <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of DUS MOCK</span> <span style="color: #00BBBB;">───────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, concept, concept_ancestor,</span></span>
<span><span class="co">#&gt; drug_strength, drug_exposure, condition_occurrence, visit_occurrence,</span></span>
<span><span class="co">#&gt; observation, concept_relationship</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> cohort1, cohort2, acetaminophen_cohort, my_cohort</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span>
<span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">my_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name       gap_era</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 6809_metformin    30     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    2 36567_simvastatin 30</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">my_new_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">my_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requirePriorDrugWashout.html">requirePriorDrugWashout</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">365</span>, cohortId <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"my_new_cohort"</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of DUS MOCK</span> <span style="color: #00BBBB;">───────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, concept, concept_ancestor,</span></span>
<span><span class="co">#&gt; drug_strength, drug_exposure, condition_occurrence, visit_occurrence,</span></span>
<span><span class="co">#&gt; observation, concept_relationship</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> cohort1, cohort2, acetaminophen_cohort, my_cohort,</span></span>
<span><span class="co">#&gt; my_new_cohort</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span>
<span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">my_new_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             55              48         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             52              48         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    2             53              48         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    2             51              48         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                    2             51              48         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="requireisfirstdrugentry">
<code>requireIsFirstDrugEntry()</code><a class="anchor" aria-label="anchor" href="#requireisfirstdrugentry"></a>
</h3>
<p>To require that the cohort entry (drug episodes) is the first one of
the available ones we can use the <code><a href="../reference/requireIsFirstDrugEntry.html">requireIsFirstDrugEntry()</a></code>
function. See example:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requireIsFirstDrugEntry.html">requireIsFirstDrugEntry</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The result will be a cohort with the individuals that fulfill the
criteria:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.acetaminophen_cohort&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         27 2019-05-22        2020-02-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         61 2017-09-27        2020-04-16     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         81 1995-09-13        1997-11-17     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         88 2015-08-19        2016-05-09     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        100 2022-12-01        2022-12-02     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1          7 1969-09-09        1970-02-14     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         37 1996-11-11        2003-08-07     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         54 2020-12-09        2021-01-31     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1         98 2020-03-14        2020-08-14     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         33 2021-02-12        2021-02-14     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>This would also get recorded in the attrition, counts and settings on
top of the already exiting ones.</p>
<p>In the settings a new column with the specified parameter used:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name   gap_era prior_use_washout limit      </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 acetaminophen 30      365               first_entry</span></span></code></pre></div>
<p>The counts will be updated:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             62              62</span></span></code></pre></div>
<p>And the attrition will have a new line:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             71              62         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             70              62         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1             66              62         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    1             62              62         4 require is the …</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="requireobservationbeforedrug">
<code>requireObservationBeforeDrug()</code><a class="anchor" aria-label="anchor" href="#requireobservationbeforedrug"></a>
</h3>
<p>To require that a cohort entry (drug episodes) has a certain time of
prior observation we can use the
<code><a href="../reference/requireObservationBeforeDrug.html">requireObservationBeforeDrug()</a></code> function. See example:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requireObservationBeforeDrug.html">requireObservationBeforeDrug</a></span><span class="op">(</span>priorObservation <span class="op">=</span> <span class="fl">365</span><span class="op">)</span></span></code></pre></div>
<p>The result will be a cohort with the individuals that fulfill the
criteria:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.acetaminophen_cohort&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         81 1995-09-13        1997-11-17     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         88 2015-08-19        2016-05-09     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         54 2020-12-09        2021-01-31     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         57 2020-04-17        2020-11-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1         79 2020-05-02        2022-02-21     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1         48 1972-04-14        1972-12-18     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1          3 1996-09-13        2008-07-15     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         42 2002-09-15        2007-12-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1         75 2010-06-16        2011-09-20     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         14 1990-04-27        1990-05-12     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>This would also get recorded in the attrition, counts and settings on
top of the already exiting ones.</p>
<p>In the settings a new column with the specified parameter used:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name   gap_era prior_use_washout limit      </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 acetaminophen 30      365               first_entry</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: prior_drug_observation &lt;chr&gt;</span></span></span></code></pre></div>
<p>The counts will be updated:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             33              33</span></span></code></pre></div>
<p>And the attrition will have a new line:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             71              62         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             70              62         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1             66              62         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    1             62              62         4 require is the …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                    1             33              33         5 require prior o…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="requiredrugindaterange">
<code>requireDrugInDateRange()</code><a class="anchor" aria-label="anchor" href="#requiredrugindaterange"></a>
</h3>
<p>To require that a cohort entry (drug episodes) has a certain date
within an specific range we can use the
<code><a href="../reference/requireDrugInDateRange.html">requireDrugInDateRange()</a></code> function. In general you would
like to apply this restriction to the incident date (cohort_start_date),
but the function is flexible and you can use it to restrict to any other
date. See example:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requireDrugInDateRange.html">requireDrugInDateRange</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"cohort_start_date"</span>, </span>
<span>    dateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The result will be a cohort with the individuals that fulfill the
criteria:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.acetaminophen_cohort&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1023-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         88 2015-08-19        2016-05-09     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         54 2020-12-09        2021-01-31     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         57 2020-04-17        2020-11-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         79 2020-05-02        2022-02-21     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1         42 2002-09-15        2007-12-19     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1         75 2010-06-16        2011-09-20     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         46 2004-06-27        2011-05-07     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         35 2005-11-10        2006-09-09     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1          8 2019-09-14        2020-12-31     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         23 2003-10-29        2003-11-27     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>This would also get recorded in the attrition, counts and settings on
top of the already exiting ones.</p>
<p>In the settings a new column with the specified parameter used:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/settings.html" class="external-link">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name   gap_era prior_use_washout limit      </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 acetaminophen 30      365               first_entry</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: prior_drug_observation &lt;chr&gt;</span></span></span></code></pre></div>
<p>The counts will be updated:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             24              24</span></span></code></pre></div>
<p>And the attrition will have a new line:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             71              62         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             70              62         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1             66              62         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    1             62              62         4 require is the …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                    1             33              33         5 require prior o…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>                    1             24              24         6 require cohort_…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
<p>If you just want to restrict on the lower or upper bound you can just
leave the other element as NA and then no condition will be applied, see
for example:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">my_new_cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">my_new_cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/requireDrugInDateRange.html">requireDrugInDateRange</a></span><span class="op">(</span>dateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"2010-12-31"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/attrition.html" class="external-link">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">my_new_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             55              48         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1             52              48         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1             23              21         3 require cohort_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    2             53              48         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                    2             51              48         2 join exposures …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>                    2             51              48         3 require prior u…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>                    2             18              18         4 require cohort_…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-order-matters">The order matters<a class="anchor" aria-label="anchor" href="#the-order-matters"></a>
</h2>
<p>It is very important to know that the different restrictions are not
commutable operations and that different order can lead to different
results. Let’s see the following example where we have an individual
with 4 cohort entries:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
<p>In this case we will see the result of combining in different ways 4
inclusion criteria:</p>
<ul>
<li>
<strong>first</strong>: <code><a href="../reference/requireIsFirstDrugEntry.html">requireIsFirstDrugEntry()</a></code>
</li>
<li>
<strong>washout</strong>:
<code>requirePriorDrugWashout(days = 365)</code>
</li>
<li>
<strong>minObs</strong>:
<code>requireObservationBeforeDrug(priorObservation = 365)</code>
</li>
<li>
<strong>2011-2012</strong>
<code>requireDrugInDateRange(dateRange = as.Date(c("2011-01-01", "2012-12-31)))</code>
</li>
</ul>
<div class="section level3">
<h3 id="first-and-washout">first and washout<a class="anchor" aria-label="anchor" href="#first-and-washout"></a>
</h3>
<p>If we would apply the initially the <strong>first</strong>
requirement and then the <strong>washout</strong> one we would end with
only the first record:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-44-1.png" width="672"></p>
<p>Whereas if we would apply initially the <strong>washout</strong>
criteria and then the <strong>first</strong> one the resulting exposure
would be the fourth one:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-45-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="first-and-minobs">first and minObs<a class="anchor" aria-label="anchor" href="#first-and-minobs"></a>
</h3>
<p>If we would apply the initially the <strong>first</strong>
requirement and then the <strong>minObs</strong> one we would end with
no record in the cohort:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-46-1.png" width="672"></p>
<p>Whereas if we would apply initially the <strong>minObs</strong>
criteria and then the <strong>first</strong> one there would be an
exposure selected, the second one:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-47-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="first-and-2011-2012">first and 2011-2012<a class="anchor" aria-label="anchor" href="#first-and-2011-2012"></a>
</h3>
<p>If we would apply the initially the <strong>first</strong>
requirement and then the <strong>2011-2012</strong> one we would end
with no record in the cohort:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-48-1.png" width="672"></p>
<p>Whereas if we would apply initially the <strong>2011-2012</strong>
criteria and then the <strong>first</strong> one there would be an
exposure selected, the second one:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-49-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="washout-and-minobs">washout and minObs<a class="anchor" aria-label="anchor" href="#washout-and-minobs"></a>
</h3>
<p>If we would apply the initially the <strong>washout</strong>
requirement and then the <strong>minObs</strong> one we would end with
only the last record selected:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-50-1.png" width="672"></p>
<p>Whereas if we would apply initially the <strong>minObs</strong>
criteria and then the <strong>washout</strong> one the second and the
fourth exposures are the ones that would be selected:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-51-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="washout-and-2011-2012">washout and 2011-2012<a class="anchor" aria-label="anchor" href="#washout-and-2011-2012"></a>
</h3>
<p>If we would apply initially the <strong>washout</strong> requirement
and then the <strong>2011-2012</strong> one no record would be
selected:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-52-1.png" width="672"></p>
<p>Whereas if we would apply initially the <strong>2011-2012</strong>
criteria and then the <strong>washout</strong> one the second record
would be included:</p>
<p><img src="create_cohorts_files/figure-html/unnamed-chunk-53-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="minobs-and-2011-2012">minObs and 2011-2012<a class="anchor" aria-label="anchor" href="#minobs-and-2011-2012"></a>
</h3>
<p>Finally <code>requireObservationBeforeDrug</code> and
<code>requireDrugInDateRange</code> will always be commutable operations
so the other of this two will always be the same.</p>
</div>
<div class="section level3">
<h3 id="recommended-order">Recommended order<a class="anchor" aria-label="anchor" href="#recommended-order"></a>
</h3>
<p>Having all this into account the recommended order to apply criteria
would be:</p>
<ol style="list-style-type: decimal">
<li><p>Require a prior drug washout or require first drug entry
(particular case).</p></li>
<li><p>Require a prior observation before the drug episode.</p></li>
<li><p>Require the drugs to be in a certain date range.</p></li>
</ol>
<p>Although this is the recommended order, your study design may have a
different required specification, for example you may be interested on
the first exposure that fulfills some criteria. Thus making applying the
require first drug entry at the end.</p>
</div>
</div>
<div class="section level2">
<h2 id="alternatives-to-create-cohorts">Alternatives to create cohorts<a class="anchor" aria-label="anchor" href="#alternatives-to-create-cohorts"></a>
</h2>
<p><code><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet()</a></code> is a very specif
function to create drug users cohorts. Most of the functions in this
package need a cohort as input, this cohort will usually be a cohort
generated using <code><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet()</a></code>, but
there exist some alternative to create cohorts</p>
<ul>
<li><p>You can create your own custom cohorts with
<code>tidyverse</code> functions and
<code><a href="https://darwin-eu-dev.github.io/omopgenerics/reference/newCohortTable.html" class="external-link">omopgenerics::newCohortTable()</a></code>. See omopgenerics
vignette.</p></li>
<li><p>You can create concept based cohorts using the <code>OHDSI</code>
package <code>CohortConstructor</code>. See CohortConstructor
“a01_building_base_cohorts”.</p></li>
<li><p>You can create cohorts based on ATLAS definitions using
CDMConnector. “a02_cohorts”</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martí Català, Mike Du, Yuchen Guo, Kim Lopez-Guell, Nuria Mercade-Besora, Xihang Chen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
