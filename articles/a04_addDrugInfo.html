<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Add drug related information to a Drug Utilisation cohort • DrugUtilisation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add drug related information to a Drug Utilisation cohort">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DrugUtilisation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_introCreateCohort.html">Use DrugUtilisation to create a cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a02_scalingOfInstantiateCohorts.html">Scaling of instantiate cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a03_addIndications-example.html">Add indications to Drug Utilisation Cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a04_addDrugInfo.html">Add drug related information to a Drug Utilisation cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a05_treatmentDiscontinuation.html">Add treatment discontinuation to a Drug Utilisation cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a06_treatmentSummary.html">Add treatment summary to a Drug Utilisation cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a07_characteriseACohort.html">Characterise a cohort using Drug Utilisation</a></li>
    <li><a class="dropdown-item" href="../articles/routePatternDose.html">Guide on using DrugUtilisataion package to compute drug use related information</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add drug related information to a Drug Utilisation cohort</h1>
                        <h4 data-toc-skip class="author">Marti Catala,
Mike Du, Yuchen Guo, Kim Lopez-Guell, Edward Burn, Xintong Li</h4>
            
            <h4 data-toc-skip class="date">2024-07-09</h4>
      

      <div class="d-none name"><code>a04_addDrugInfo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The DrugUtilisation package includes a range of functions that add
drug-related information of subjects in OMOP CDM tables and cohort
tables. In this vignette, we will explore these functions and provide
some examples for its usage.</p>
<div class="section level3">
<h3 id="create-mock-data-first">Create mock data first<a class="anchor" aria-label="anchor" href="#create-mock-data-first"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/PatientProfiles/" class="external-link">PatientProfiles</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockDrugUtilisation.html">mockDrugUtilisation</a></span><span class="op">(</span>numberIndividual  <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-drug-utilisation-cohort">Create a drug utilisation cohort<a class="anchor" aria-label="anchor" href="#create-a-drug-utilisation-cohort"></a>
</h3>
<p>We will use <em>Acetaminophen</em> as our example drug to construct
our drug utilisation cohort. To begin, we will employ
<code><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes()</a></code> function from CodelistGenerator to
generate a concept list associated with <em>Acetaminophen</em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conceptList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"acetaminophen"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conceptList</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - acetaminophen (4 codes)</span></span></code></pre></div>
<p>Next, we create a drug utilisation cohort by using the
<code>conceptList</code> with the
<code><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet()</a></code> function. For a better
understanding of the arguments and functionalities of
<code><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet()</a></code>, please refer to the
<em>Use DrugUtilisation to create a cohort</em> vignette.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span></span>
<span>  cdm  <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"acetaminophen_example1"</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptList</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-routes-with-addroute-function">Adding routes with addRoute() function<a class="anchor" aria-label="anchor" href="#adding-routes-with-addroute-function"></a>
</h2>
<p><code><a href="../reference/addRoute.html">addRoute()</a></code> function utilises an internal CSV file
containing all possible routes for various drug dose forms supported by
the package. The function is designed to seamlessly incorporate route
information into your drug table for the supported dose forms. See the
example below to know how it works.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"drug_exposure"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addRoute.html">addRoute</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 8]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                1         1         1<span style="text-decoration: underline;">503</span>328 2022-01-11              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                2         1         2<span style="text-decoration: underline;">905</span>077 2021-10-26              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                3         1         1<span style="text-decoration: underline;">539</span>463 2021-08-10              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                4         1         1<span style="text-decoration: underline;">516</span>980 2021-12-20              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                5         2         1<span style="text-decoration: underline;">516</span>978 2013-05-09              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                6         2         2<span style="text-decoration: underline;">905</span>077 2013-01-20              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                7         3         1<span style="text-decoration: underline;">125</span>360 2013-05-25              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                9         3         1<span style="text-decoration: underline;">516</span>978 2010-07-16              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>               10         3         2<span style="text-decoration: underline;">905</span>077 2013-01-26              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>               11         4         1<span style="text-decoration: underline;">125</span>360 2003-12-11              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;, route &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generating-patterns-with-patterntable-function">Generating patterns with patternTable() function<a class="anchor" aria-label="anchor" href="#generating-patterns-with-patterntable-function"></a>
</h2>
<p>The <code><a href="../reference/patternTable.html">patternTable()</a></code> function in the DrugUtilisation
package is a powerful tool for deriving patterns from a drug strength
table. This function extracts distinct patterns, associating them with
<code>pattern_id</code> and <code>formula_id</code>. The resulting
tibble provides the following data:</p>
<ul>
<li>
<code>number_concepts</code>: the count of distinct concepts in the
patterns.</li>
<li>
<code>number_ingredients</code>: the count of distinct ingredients
involved.</li>
<li>
<code>number_records</code>: the overall count of records in the
patterns.</li>
</ul>
<p>Moreover, the tibble includes a column indicating potentially valid
and invalid combinations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/patternTable.html">patternTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 12</span></span></span>
<span><span class="co">#&gt;   pattern_id formula_name            validity number_concepts number_ingredients</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          9 fixed amount formulati… pattern…               7                  4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         18 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         24 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         40 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                      no patt…               4                  4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: number_records &lt;dbl&gt;, amount_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   amount_unit_concept_id &lt;dbl&gt;, numerator_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   numerator_unit_concept_id &lt;dbl&gt;, denominator_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   denominator_unit_concept_id &lt;dbl&gt;</span></span></span></code></pre></div>
<p>For detailed information about the patterns, their associated
formula, and combinations of <code>amount_unit</code>,
<code>numerator_unit</code>, and <code>denominator_unit</code>, you can
refer to the data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patternsWithFormula</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-daily-dose-with-adddailydose-function">Get daily dose with addDailyDose() function<a class="anchor" aria-label="anchor" href="#get-daily-dose-with-adddailydose-function"></a>
</h2>
<p>Now that we have all the patterns and formulas supported, the
computation of daily doses can be performed using the
<code><a href="../reference/addDailyDose.html">addDailyDose()</a></code> function. This function will add to the data
with additional columns, including those for quantity, daily dose, unit,
and route.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/addDailyDose.html">addDailyDose</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;og_009_1720514757&gt; [?? x 9]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                2         1         2<span style="text-decoration: underline;">905</span>077 2021-10-26              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                6         2         2<span style="text-decoration: underline;">905</span>077 2013-01-20              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                7         3         1<span style="text-decoration: underline;">125</span>360 2013-05-25              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>               10         3         2<span style="text-decoration: underline;">905</span>077 2013-01-26              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>               11         4         1<span style="text-decoration: underline;">125</span>360 2003-12-11              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>               13         4         1<span style="text-decoration: underline;">125</span>360 1990-09-04              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>               15         4        43<span style="text-decoration: underline;">135</span>274 1995-04-04              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>               21         6        43<span style="text-decoration: underline;">135</span>274 2020-05-19              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>               25         7         2<span style="text-decoration: underline;">905</span>077 2005-11-18              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>               26         7         2<span style="text-decoration: underline;">905</span>077 2008-10-22              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;, daily_dose &lt;dbl&gt;, unit &lt;chr&gt;</span></span></span></code></pre></div>
<p>There is also a function, <code><a href="../reference/summariseDoseCoverage.html">summariseDoseCoverage()</a></code>, to
check the coverage of daily dose computation for chosen concept sets and
ingredients.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summariseDoseCoverage.html">summariseDoseCoverage</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="fl">1125315</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The following estimates will be computed:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> daily_dose: count_missing, percentage_missing, mean, sd, q25, median, q75</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Table is collected to memory as not all requested estimates are supported on</span></span>
<span><span class="co">#&gt;   the database side</span></span>
<span><span class="co">#&gt; → Start summary of data, at 2024-07-09 08:45:57.589878</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Summary finished, at 2024-07-09 08:45:57.868762</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 56 × 13</span></span></span>
<span><span class="co">#&gt;    result_id cdm_name group_name      group_level   strata_name strata_level</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         1 DUS MOCK ingredient_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         1 DUS MOCK ingredient_name acetaminophen unit        milligram   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         1 DUS MOCK ingredient_name acetaminophen unit        milligram   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 46 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: variable_name &lt;chr&gt;, variable_level &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   estimate_name &lt;chr&gt;, estimate_type &lt;chr&gt;, estimate_value &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   additional_name &lt;chr&gt;, additional_level &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-drug-usage-details-to-a-cohort-with-adddruguse-function">Adding Drug Usage Details to a Cohort with addDrugUse()
function<a class="anchor" aria-label="anchor" href="#adding-drug-usage-details-to-a-cohort-with-adddruguse-function"></a>
</h2>
<p>Additional drug usage details, including duration, initial dose,
cumulative dose, etc., can be incorporated into a cohort using the
<code><a href="../reference/addDrugUse.html">addDrugUse()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_example1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span>ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;og_016_1720514767&gt; [?? x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1          3 2013-05-25        2015-11-12           902</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         73 2021-04-16        2021-04-30            15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1          9 1989-02-04        1992-11-02          <span style="text-decoration: underline;">1</span>368</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         26 1991-01-10        1991-05-19           130</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1         19 2020-12-22        2021-11-11           325</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1          4 2013-04-21        2015-04-01           711</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         52 2015-12-13        2016-01-04            23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1        183 2011-05-07        2013-07-10           796</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1          1 2021-10-26        2022-01-22            89</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1        113 1998-10-25        1998-11-28            35</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="duration-parameter">duration parameter<a class="anchor" aria-label="anchor" href="#duration-parameter"></a>
</h3>
<p>The <code>duration</code> parameter is a boolean variable
(<code>TRUE</code>/<code>FALSE</code>) determining whether to include
duration related columns, which correspond to:</p>
<ol style="list-style-type: decimal">
<li>
<code>duration</code>: duration is calculated as
<code>cohort_end_date - cohort_start_date + 1</code>.</li>
<li>
<code>impute_duration_percentage</code>: if a drug exposure record
does not have the duration of the exposure, or falls outside the
specified duration range, duration will be imputed. The number of
records that have been imputed or that would have been imputed (if we
choose not to impute the duration) is recorded in this column.</li>
</ol>
<p>To set the imputation method for duration, use the
<code>imputeDuration</code> input, which can take values such as
<code>none</code> (default), <code>median</code>, <code>mode</code> or a
numerical value. Define the <code>durationRange</code> parameter as a
numeric vector of length two, where the first value should be equal or
smaller than the second one. If set to NULL, no restrictions are
applied.</p>
</div>
<div class="section level3">
<h3 id="quantity-parameter">quantity parameter<a class="anchor" aria-label="anchor" href="#quantity-parameter"></a>
</h3>
<p>The <code>quantity</code> parameter, another boolean variable
(<code>TRUE</code>/<code>FALSE</code>), controls the inclusion of
quantity-related columns. If set to <code>TRUE</code> (default), the
following columns are added:</p>
<ol style="list-style-type: decimal">
<li>
<code>cumulative_quantity</code>: cumulative sum of the column
<code>quantity</code> of the <code>drug_exposure</code> table during the
drug exposure period.</li>
<li>
<code>initial_quantity</code>: quantity at
<code>drug_exposure_start_date</code>.</li>
</ol>
</div>
<div class="section level3">
<h3 id="dose-parameter">dose parameter<a class="anchor" aria-label="anchor" href="#dose-parameter"></a>
</h3>
<p>The <code>dose</code> parameter, also a boolean variable
(<code>TRUE</code>/<code>FALSE</code>), governs the addition of daily
dose-related columns. When set to <code>TRUE</code>, the following
columns are added:</p>
<ol style="list-style-type: decimal">
<li>
<code>initial_daily_dose_milligram</code>: dose at
<code>drug_exposure_start_date</code>.</li>
<li>
<code>cumulative_dose_milligram</code>: cumulative sum of the column
<code>dose</code> of <code>drug_exposure</code> table during the drug
exposure period.</li>
<li>
<code>impute_daily_dose_percentage</code>: If daily dose is missing,
or falls outside the imputation range, records will be imputed. This
column shows the number of records that have been imputed or that would
have been imputed (if we choose not to impute the daily dose).</li>
</ol>
<p>Similar to duration imputation, use the <code>imputeDose</code>
parameter to set the method for imputing daily dose, with options like
<code>none</code> (default), <code>median</code>, <code>mean</code>,
<code>mode</code>. Define the imputation range with the
<code>dailyDoseRange</code> parameter, a numeric vector of length two,
where the first value should be equal or smaller than the second one. If
set to NULL, no restrictions are applied.</p>
<p>These parameters offer flexibility in customizing the drug usage
details added to the cohort. See the next example, where we use the
cohort created at the beginning of this vignette
<em>acetaminophen_example1</em>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span></span>
<span>  cohort <span class="op">=</span> <span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  cdm    <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>  duration <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quantity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dose     <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;og_021_1720514775&gt; [?? x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         19 2020-12-22        2021-11-11           325</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         52 2015-12-13        2016-01-04            23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1        183 2011-05-07        2013-07-10           796</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1          4 2013-04-21        2015-04-01           711</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1          3 2013-05-25        2015-11-12           902</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1         73 2021-04-16        2021-04-30            15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1          9 1989-02-04        1992-11-02          <span style="text-decoration: underline;">1</span>368</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         26 1991-01-10        1991-05-19           130</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1        113 1998-10-25        1998-11-28            35</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         92 2013-04-13        2013-06-28            77</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre></div>
<p>If all these parameters are set to false, only
<code>number_exposures</code> and <code>number_eras</code> will be
added.</p>
</div>
<div class="section level3">
<h3 id="parameters-for-joining-exposures">Parameters for Joining Exposures<a class="anchor" aria-label="anchor" href="#parameters-for-joining-exposures"></a>
</h3>
<p>The way continuous exposures are joined can be configured by using
different parameters. Let’s have a look to all the options we have.</p>
<div class="section level4">
<h4 id="gapera-parameter">gapEra parameter<a class="anchor" aria-label="anchor" href="#gapera-parameter"></a>
</h4>
<p>This parameter sets the number of days between two continuous
exposures to be considered in the same era. If the previous exposure’s
end date minus the next exposure’s start date is less than or equal to
the specified <code>gapEra</code>, these two exposures will be joined.
Let’s see an illustrative example.</p>
<p>First, let’s create a cohort with <code>gapEra = 0</code>. For a
better understanding, we will observe only subject number 56.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"acetaminophen_example2"</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptList</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span> </span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">drug_concept_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">conceptList</span><span class="op">$</span><span class="va">acetaminophen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">person_id</span> <span class="op">==</span> <span class="fl">56</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 7]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              166        56         1<span style="text-decoration: underline;">125</span>360 2022-01-27              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>              164        56        43<span style="text-decoration: underline;">135</span>274 2021-08-08              </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;</span></span></span></code></pre></div>
<p>This subject has two different drug exposure periods separated by
less than 6 months. Hence, it has two different cohort periods:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example2"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span></span>
<span>    ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>    gapEra <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op">==</span> <span class="fl">56</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         56 2022-01-27        2022-03-04            37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1         56 2021-08-08        2021-09-17            41</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now, we merge this two periods by modifying the <code>gapEra</code>
input when creating the cohort. For a better understanding of
<code>gapEra</code> arguments and functionalities, please see <em>Use
DrugUtilisation to create a cohort</em> vignette.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"acetaminophen_example3"</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptList</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">180</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_example3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span></span>
<span>    ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>    gapEra <span class="op">=</span> <span class="fl">180</span>,</span>
<span>    duration <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    quantity <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    dose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op">==</span> <span class="fl">56</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [1 x 8]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         56 2021-08-08        2022-03-04           209</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: number_exposures &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;</span></span></span></code></pre></div>
<p>See that we only have one record with two exposures for subject
number 56. Note that the number of eras is still 1, as we have defined
the same <code>gapEra</code> as when the cohort was created. However, it
is possible to specify a different <code>gapEra</code> than the one
defined when the cohort was created.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">acetaminophen_example3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span></span>
<span>    ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>    gapEra <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op">==</span> <span class="fl">56</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [1 x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         56 2021-08-08        2022-03-04           209</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Notice that <code>number_eras</code> now indicates that we have two
eras within the same record.</p>
</div>
<div class="section level4">
<h4 id="erajoinmode-parameter">eraJoinMode parameter<a class="anchor" aria-label="anchor" href="#erajoinmode-parameter"></a>
</h4>
<p>This parameter defines how two different continuous exposures are
joined in an era. There are four options:</p>
<ol style="list-style-type: decimal">
<li>
<code>eraJoinMode = "zero"</code> (default option): Exposures are
joined considering that the period between both continuous exposures
means the subject is treated with a daily dose of zero. The time between
both exposures contributes to the total exposed time.</li>
<li>
<code>eraJoinMode = "join"</code>: Exposures are joined, considering
that the period between both continuous exposures means the subject is
treated with a daily dose of zero. The time between both exposures does
not contribute to the total exposed time.</li>
<li>
<code>eraJoinMode = "previous"</code>: Exposures are joined,
considering that the period between both continuous exposures means the
subject is treated with the daily dose of the previous subexposure. The
time between both exposures contributes to the total exposed time.</li>
<li>
<code>eraJoinMode = "subsequent"</code>: Exposures are joined,
considering that the period between both continuous exposures means the
subject is treated with the daily dose of the subsequent subexposure.
The time between both exposures contributes to the total exposed
time.</li>
</ol>
</div>
<div class="section level4">
<h4 id="overlapmode-parameter">
<code>overlapMode</code> parameter<a class="anchor" aria-label="anchor" href="#overlapmode-parameter"></a>
</h4>
<p>This parameter defines how the overlapping between two exposures that
do not start on the same day is resolved inside a subexposure. There are
five possible options:</p>
<ol style="list-style-type: decimal">
<li>
<code>overlapMode* = "sum"</code> (default): The considered daily
dose is the sum of all the exposures present in the subexposure.</li>
<li>
<code>overlapMode = minimum</code>: The considered daily dose is the
minimum of all the exposures in the subexposure.</li>
<li>
<code>overlapMode = maximum</code>: The considered daily dose is the
maximum of all the exposures in the subexposure.</li>
<li>
<code>overlapMode = previous</code>: The considered daily dose is
that of the earliest exposure.</li>
<li>
<code>overlapMode = subsequent</code>: The considered daily dose is
that of the latest exposure.</li>
</ol>
</div>
<div class="section level4">
<h4 id="sameindexmode-parameter">sameIndexMode parameter<a class="anchor" aria-label="anchor" href="#sameindexmode-parameter"></a>
</h4>
<p>This parameter works similarly to <code>overlapMode</code>, but it
customizes the overlapping between two exposures starting on the same
date. It includes the options <code>sum</code> (default),
<code>minimum</code>, and <code>maximum</code> described in
<code>overlapMode</code>.</p>
<p>For example, the following example sets a maximum gap of 30 days for
exposures to be joined. It uses the daily dose of the previous
subexposure when joining exposures, employs the minimum daily dose for
exposures starting on the same day, and considers the minimum daily dose
for exposures that overlap.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span>ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>             gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>             eraJoinMode <span class="op">=</span> <span class="st">"previous"</span>,</span>
<span>             overlapMode <span class="op">=</span> <span class="st">"minimum"</span>,</span>
<span>             sameIndexMode <span class="op">=</span> <span class="st">"minimum"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;og_040_1720514819&gt; [?? x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.0.0 [unknown@Linux 6.5.0-1022-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         19 2020-12-22        2021-11-11           325</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1          3 2013-05-25        2015-11-12           902</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         73 2021-04-16        2021-04-30            15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1          9 1989-02-04        1992-11-02          <span style="text-decoration: underline;">1</span>368</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1         26 1991-01-10        1991-05-19           130</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1          4 2013-04-21        2015-04-01           711</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         52 2015-12-13        2016-01-04            23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1        183 2011-05-07        2013-07-10           796</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1        114 2022-10-17        2022-11-13            28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1        184 2009-04-22        2010-03-13           326</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summarise-drug-usage-information-with-summarisedruguse-function">Summarise drug usage information with summariseDrugUse()
function<a class="anchor" aria-label="anchor" href="#summarise-drug-usage-information-with-summarisedruguse-function"></a>
</h2>
<p>This functions creates a tibble summarising the dose table across
multiple cohorts. See an example below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span></span>
<span>    cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summariseDrugUse.html">summariseDrugUse</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 101 × 13</span></span></span>
<span><span class="co">#&gt;    result_id cdm_name group_name  group_level   strata_name strata_level</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 91 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: variable_name &lt;chr&gt;, variable_level &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   estimate_name &lt;chr&gt;, estimate_type &lt;chr&gt;, estimate_value &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   additional_name &lt;chr&gt;, additional_level &lt;chr&gt;</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="strata-parameter">strata parameter<a class="anchor" aria-label="anchor" href="#strata-parameter"></a>
</h3>
<p>We can also stratify our cohort and calculate the estimates within
each strata group by using the <code>strata</code> parameter.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://darwin-eu-dev.github.io/PatientProfiles/reference/addSex.html" class="external-link">addSex</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Function from PatientProfiles</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summariseDrugUse.html">summariseDrugUse</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen_example1"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sex"</span> <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 303 × 13</span></span></span>
<span><span class="co">#&gt;    result_id cdm_name group_name  group_level   strata_name strata_level</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         1 DUS MOCK cohort_name acetaminophen overall     overall     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 293 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: variable_name &lt;chr&gt;, variable_level &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   estimate_name &lt;chr&gt;, estimate_type &lt;chr&gt;, estimate_value &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   additional_name &lt;chr&gt;, additional_level &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="drugestimates-parameter">drugEstimates parameter<a class="anchor" aria-label="anchor" href="#drugestimates-parameter"></a>
</h3>
<p>Customize the estimates to be calculated by using the
<code>drugEstimates</code> parameter. By default, it will compute the
minimum value, quartiles (5%, 25%, 50% - median, 75% and 95%), the
maximum value, the mean, the standard deviation, and the number of
missings values for each column added with
<code><a href="../reference/addDrugUse.html">addDrugUse()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="mincellcount-parameter">minCellCount parameter<a class="anchor" aria-label="anchor" href="#mincellcount-parameter"></a>
</h3>
<p>Specify the minimum number of individuals that a strata group must
have in order to appear in the table.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marti Catala, Mike Du, Yuchen Guo, Kim Lopez-Guell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
