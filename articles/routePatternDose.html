<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DrugUtilisation">
<title>Guide on using DrugUtilisataion package to compute drug use related information • DrugUtilisation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Guide on using DrugUtilisataion package to compute drug use related information">
<meta property="og:description" content="DrugUtilisation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DrugUtilisation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_introCreateCohort.html">Use DrugUtilisation to create a cohort</a>
    <a class="dropdown-item" href="../articles/a02_scalingOfInstantiateCohorts.html">Scaling of instantiate cohorts</a>
    <a class="dropdown-item" href="../articles/a03_addIndications-example.html">Add indications to Drug Utilisation Cohort</a>
    <a class="dropdown-item" href="../articles/a04_addDrugInfo.html">Add drug related information to a Drug Utilisation cohort</a>
    <a class="dropdown-item" href="../articles/a05_treatmentDiscontinuation.html">Add treatment discontinuation to a Drug Utilisation cohort</a>
    <a class="dropdown-item" href="../articles/a06_treatmentSummary.html">Add treatment summary to a Drug Utilisation cohort</a>
    <a class="dropdown-item" href="../articles/a07_characteriseACohort.html">Characterise a cohort using Drug Utilisation</a>
    <a class="dropdown-item" href="../articles/routePatternDose.html">Guide on using DrugUtilisataion package to compute drug use related information</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Guide on using DrugUtilisataion package to compute drug use related information</h1>
                        <h4 data-toc-skip class="author">Marti Catala,
Mike Du, Yuchen Guo, Kim Lopez-Guell, Edward Burn, Xintong Li</h4>
            
      
      
      <div class="d-none name"><code>routePatternDose.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="adding-routes-with-addroute-function">Adding Routes with <code>addRoute</code> Function<a class="anchor" aria-label="anchor" href="#adding-routes-with-addroute-function"></a>
</h2>
<p>To enrich your drug data, the DrugUtilisation package provides the
<code>addRoute</code> function. This function utilizes an internal CSV
file containing all possible routes for various drug dose forms
supported by the package.</p>
<p>The <code>addRoute</code> function is designed to seamlessly
incorporate route information into your drug table for the supported
dose forms. In the example below, a mock database is generated using the
<code>mockDrugUtilisation</code> function, and the <code>addRoute</code>
function is applied to demonstrate the process:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">":memory:"</span><span class="op">)</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  writeSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cdmPrefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  writePrefix <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockDrugUtilisation.html">mockDrugUtilisation</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  numberIndividual <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Add route information to the drug table</span></span>
<span><span class="fu"><a href="../reference/addRoute.html">addRoute</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   SQL [?? x 8]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.2/:memory:]</span></span></span>
<span><span class="co">##    drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">##               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                2         1         1<span style="text-decoration: underline;">516</span>980 2001-02-27              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>                3         2         1<span style="text-decoration: underline;">516</span>980 2018-03-08              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>                4         2         1<span style="text-decoration: underline;">516</span>978 2018-05-28              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>                5         2         1<span style="text-decoration: underline;">516</span>978 2018-06-14              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>                6         2         1<span style="text-decoration: underline;">539</span>463 2017-07-03              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>                8         3        43<span style="text-decoration: underline;">135</span>274 1996-09-13              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>               11         4         1<span style="text-decoration: underline;">503</span>328 2007-05-14              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>               12         4         1<span style="text-decoration: underline;">125</span>360 2004-12-26              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>               13         5         1<span style="text-decoration: underline;">539</span>463 1986-08-21              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>               14         5         1<span style="text-decoration: underline;">503</span>328 1979-06-27              </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;, route &lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="generating-patterns-with-patterntable-function">Generating Patterns with patternTable Function<a class="anchor" aria-label="anchor" href="#generating-patterns-with-patterntable-function"></a>
</h2>
<p>The <code>patternTable</code> function in the DrugUtilisation package
is a powerful tool for deriving patterns from a drug strength table.
This function extracts distinct patterns, associating them with
<code>pattern_id</code> and <code>formula_id</code>. The resulting
tibble provides valuable insights into the data:</p>
<ul>
<li>
<code>number_concepts</code>: the count of distinct concepts in the
patterns.</li>
<li>
<code>number_ingredients</code>: the count of distinct ingredients
involved.</li>
<li>
<code>number_records</code>: the overall count of records in the
patterns.</li>
</ul>
<p>Moreover, the tibble includes a column indicating potentially valid
and invalid combinations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/patternTable.html">patternTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 12</span></span></span>
<span><span class="co">##   pattern_id formula_name            validity number_concepts number_ingredients</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>          9 fixed amount formulati… pattern…               7                  4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         18 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         24 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         40 concentration formulat… pattern…               1                  1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                      no patt…               4                  4</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 7 more variables: number_records &lt;dbl&gt;, amount_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   amount_unit_concept_id &lt;dbl&gt;, numerator_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   numerator_unit_concept_id &lt;dbl&gt;, denominator_numeric &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   denominator_unit_concept_id &lt;dbl&gt;</span></span></span></code></pre>
<p>For detailed information about the patterns, their associated
formula, and combinations of <code>amount_unit</code>,
<code>numerator_unit</code>, and <code>denominator_unit</code>, you can
refer to the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patternsWithFormula</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-daily-dose">Get daily dose<a class="anchor" aria-label="anchor" href="#get-daily-dose"></a>
</h2>
<p>Now that we have all the patterns and formulas supported, the
computation of daily doses can be performed using the
<code>addDailyDose</code> function. This function will add to the data
with additional columns, including those for quantity, daily dose, unit,
and route.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/addDailyDose.html">addDailyDose</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span><span class="op">$</span><span class="va">drug_exposure</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   table&lt;dbplyr_007&gt; [?? x 9]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.2/:memory:]</span></span></span>
<span><span class="co">##    drug_exposure_id person_id drug_concept_id drug_exposure_start_date</span></span>
<span><span class="co">##               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                8         3        43<span style="text-decoration: underline;">135</span>274 1996-09-13              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>               12         4         1<span style="text-decoration: underline;">125</span>360 2004-12-26              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>               17         7         1<span style="text-decoration: underline;">125</span>360 1969-09-09              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>               23         8         2<span style="text-decoration: underline;">905</span>077 2019-09-14              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>               24         9         1<span style="text-decoration: underline;">125</span>360 2019-05-14              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>               27         9        43<span style="text-decoration: underline;">135</span>274 2016-03-17              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>               34        12        43<span style="text-decoration: underline;">135</span>274 2018-10-17              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>               35        13        43<span style="text-decoration: underline;">135</span>274 1981-07-11              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>               40        14         1<span style="text-decoration: underline;">125</span>360 1990-04-27              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>               49        19         2<span style="text-decoration: underline;">905</span>077 2022-02-12              </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: drug_exposure_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   drug_type_concept_id &lt;dbl&gt;, quantity &lt;dbl&gt;, daily_dose &lt;dbl&gt;, unit &lt;chr&gt;</span></span></span></code></pre>
<p>There is also a function, <code>dailyDoseCoverage</code>, to check
the coverage of daily dose computation for chosen concept sets and
ingredients.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/dailyDoseCoverage.html">dailyDoseCoverage</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="fl">1125315</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 84 × 15</span></span></span>
<span><span class="co">##    cdm_name result_type   package_name    package_version group_name group_level</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> DUS MOCK dose_coverage DrugUtilisation 0.5.0           ingredien… acetaminop…</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 74 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 9 more variables: strata_name &lt;chr&gt;, strata_level &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   variable_name &lt;chr&gt;, variable_level &lt;chr&gt;, estimate_name &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   estimate_type &lt;chr&gt;, estimate_value &lt;chr&gt;, additional_name &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   additional_level &lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="adding-drug-usage-details-to-a-cohort-with-adddruguse">Adding Drug Usage Details to a Cohort with
<code>addDrugUse</code><a class="anchor" aria-label="anchor" href="#adding-drug-usage-details-to-a-cohort-with-adddruguse"></a>
</h2>
<p>Additional drug usage details, including duration, initial dose,
cumulative dose, etc., can be incorporated into a cohort using the
<code>addDrugUse</code> function.</p>
<div class="section level3">
<h3 id="parameters-in-adddruguse-function">Parameters in <code>addDrugUse</code> Function<a class="anchor" aria-label="anchor" href="#parameters-in-adddruguse-function"></a>
</h3>
<div class="section level4">
<h4 id="duration-parameter">
<code>duration</code> Parameter<a class="anchor" aria-label="anchor" href="#duration-parameter"></a>
</h4>
<p>The <code>duration</code> parameter is a boolean variable
(<code>TRUE</code>/<code>FALSE</code>) determining whether to include
the duration column. When set to <code>TRUE</code>, the duration is
calculated as <code>cohort_end_date - cohort_start_date + 1</code>.
Additionally, a column named <code>impute_duration_percentage</code> is
added, reporting the percentage of imputed duration.</p>
<p>To set the imputation method for duration, use the
<code>imputeDuration</code> parameter, which can take values such as
“none,” “median,” “mean,” or “mode.” Define the imputation range with
the <code>durationRange</code> parameter, a numeric vector of length
two, where the first value should be equal or smaller than the second
one.</p>
</div>
<div class="section level4">
<h4 id="quantity-parameter">
<code>quantity</code> Parameter<a class="anchor" aria-label="anchor" href="#quantity-parameter"></a>
</h4>
<p>The <code>quantity</code> parameter, another boolean variable
(<code>TRUE</code>/<code>FALSE</code>), controls the inclusion of
quantity-related columns. If set to <code>TRUE</code>, columns for
initial quantity and cumulative quantity are added.</p>
</div>
<div class="section level4">
<h4 id="dose-parameter">
<code>dose</code> Parameter<a class="anchor" aria-label="anchor" href="#dose-parameter"></a>
</h4>
<p>The <code>dose</code> parameter, also a boolean variable
(<code>TRUE</code>/<code>FALSE</code>), governs the addition of daily
dose-related columns. When set to <code>TRUE</code>, columns for initial
daily dose and cumulative daily dose are incorporated. Moreover, a
column named <code>impute_daily_dose_percentage</code> is added,
reporting the percentage of imputed daily dose.</p>
<p>Similar to the duration imputation, use the
<code>imputeDuration</code> parameter to set the method for imputing
daily dose, with options like “none,” “median,” “mean,” or “mode.”
Define the imputation range with the <code>dailyDoseRange</code>
parameter, a numeric vector of length two.</p>
<p>These parameters offer flexibility in customizing the drug usage
details added to the cohort.</p>
<p>An example is provided where these parameters are set to
<code>TRUE</code>, utilizing the drug ingredient acetaminophen.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockDrugUtilisation.html">mockDrugUtilisation</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>, <span class="st">"dus_cohort"</span>, <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="st">"acetaminophen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"dus_cohort"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>             duration <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             quantity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             dose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             <span class="fl">1125315</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `cdm` argument of `addDrugUse()` is deprecated as of DrugUtilisation 0.5.0.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   table&lt;dbplyr_015&gt; [?? x 13]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.2/:memory:]</span></span></span>
<span><span class="co">##    cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">##                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                    1          5 2014-07-28        2019-11-20          <span style="text-decoration: underline;">1</span>942</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>                    1          9 2022-09-11        2022-11-09            60</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>                    1          2 2022-06-06        2022-06-07             2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>                    1          3 2009-04-18        2009-11-07           204</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>                    1          6 1991-01-28        1991-09-17           233</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>                    1          4 2021-05-05        2021-12-15           225</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>                    1          2 2022-05-24        2022-06-02            10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>                    1          8 2012-02-15        2012-02-17             3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>                    1          7 2016-02-01        2017-10-04           612</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>                    1          1 2021-02-25        2021-03-11            15</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="parameters-for-joining-exposures">Parameters for Joining Exposures<a class="anchor" aria-label="anchor" href="#parameters-for-joining-exposures"></a>
</h3>
<p>Finally, the way continuous exposures are joined can be configured
using the following parameters:</p>
<div class="section level4">
<h4 id="gapera">
<code>gapEra</code>:<a class="anchor" aria-label="anchor" href="#gapera"></a>
</h4>
<p>This parameter sets the number of days between two continuous
exposures to be considered in the same era. If the previous exposure’s
end date minus the next exposure’s start date is less than or equal to
the specified <code>gapEra</code>, these two exposures will be
joined.</p>
</div>
<div class="section level4">
<h4 id="erajoinmode">
<code>eraJoinMode</code>:<a class="anchor" aria-label="anchor" href="#erajoinmode"></a>
</h4>
<p>This parameter defines how two different continuous exposures are
joined in an era. There are four options: - “zero”: Exposures are
joined, considering that the period between both continuous exposures
means the subject is treated with a daily dose of zero. The time between
both exposures contributes to the total exposed time. - “join”:
Exposures are joined, considering that the period between both
continuous exposures means the subject is treated with a daily dose of
zero. The time between both exposures does not contribute to the total
exposed time. - “previous”: Exposures are joined, considering that the
period between both continuous exposures means the subject is treated
with the daily dose of the previous subexposure. The time between both
exposures contributes to the total exposed time. - “subsequent”:
Exposures are joined, considering that the period between both
continuous exposures means the subject is treated with the daily dose of
the subsequent subexposure. The time between both exposures contributes
to the total exposed time.</p>
</div>
<div class="section level4">
<h4 id="overlapmode-this-parameter-defines-how-the-overlapping-between-two-exposures-that-do-not-start-on-the-same-day-is-resolved-inside-a-subexposure--there-are-five-possible-options">
<code>overlapMode</code>: This parameter defines how the overlapping
between two exposures that do not start on the same day is resolved
inside a subexposure. There are five possible options:<a class="anchor" aria-label="anchor" href="#overlapmode-this-parameter-defines-how-the-overlapping-between-two-exposures-that-do-not-start-on-the-same-day-is-resolved-inside-a-subexposure--there-are-five-possible-options"></a>
</h4>
<pre><code>- "previous": The considered daily dose is that of the earliest exposure.
- "subsequent": The considered daily dose is that of the new exposure that starts in that subexposure.
- "minimum": The considered daily dose is the minimum of all the exposures in the subexposure.
- "maximum": The considered daily dose is the maximum of all the exposures in the subexposure.
- "sum": The considered daily dose is the sum of all the exposures present in the subexposure.</code></pre>
</div>
<div class="section level4">
<h4 id="sameindexmode-this-parameter-defines-how-the-overlapping-between-two-exposures-that-start-on-the-same-day-is-resolved-inside-a-subexposure--there-are-three-possible-options">
<code>sameIndexMode</code>: This parameter defines how the
overlapping between two exposures that start on the same day is resolved
inside a subexposure. There are three possible options:<a class="anchor" aria-label="anchor" href="#sameindexmode-this-parameter-defines-how-the-overlapping-between-two-exposures-that-start-on-the-same-day-is-resolved-inside-a-subexposure--there-are-three-possible-options"></a>
</h4>
<pre><code>- "minimum": The considered daily dose is the minimum of all the exposures in the subexposure.
- "maximum": The considered daily dose is the maximum of all the exposures in the subexposure.
- "sum": The considered daily dose is the sum of all the exposures present in the subexposure.</code></pre>
<p>For example, the following settings a maximum gap of 30 days for
exposures to be joined. It uses the daily dose of the previous
subexposure when joining exposures, employs the minimum daily dose for
exposures starting on the same day, and considers the minimum daily dose
for exposures that overlap.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">[[</span><span class="st">"dus_cohort"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDrugUse.html">addDrugUse</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>             ingredientConceptId <span class="op">=</span> <span class="fl">1125315</span>,</span>
<span>             gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>             eraJoinMode <span class="op">=</span> <span class="st">"previous"</span>,</span>
<span>             overlapMode <span class="op">=</span> <span class="st">"minimum"</span>,</span>
<span>             sameIndexMode <span class="op">=</span> <span class="st">"minimum"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   table&lt;dbplyr_019&gt; [?? x 13]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.2/:memory:]</span></span></span>
<span><span class="co">##    cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">##                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                    1          5 2014-07-28        2019-11-20          <span style="text-decoration: underline;">1</span>942</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>                    1          9 2022-09-11        2022-11-09            60</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>                    1          2 2022-06-06        2022-06-07             2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>                    1          3 2009-04-18        2009-11-07           204</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>                    1          6 1991-01-28        1991-09-17           233</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>                    1          4 2021-05-05        2021-12-15           225</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>                    1          2 2022-05-24        2022-06-02            10</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>                    1          8 2012-02-15        2012-02-17             3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>                    1          7 2016-02-01        2017-10-04           612</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>                    1          1 2021-02-25        2021-03-11            15</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 8 more variables: number_exposures &lt;dbl&gt;, cumulative_quantity &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   initial_quantity &lt;dbl&gt;, impute_duration_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   number_eras &lt;dbl&gt;, impute_daily_dose_percentage &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   initial_daily_dose_milligram &lt;dbl&gt;, cumulative_dose_milligram &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marti Catala, Mike Du, Yuchen Guo, Kim Lopez-Guell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
